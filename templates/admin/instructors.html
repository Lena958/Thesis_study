<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Instructors</title>

  <link rel="stylesheet" href="{{ url_for('static', filename='css/instructors.css') }}">
  <link rel="icon" type="image/png" href="{{ url_for('static', filename='images/brand.png') }}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

  <!-- PDF libs -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

  <style>
    .btn-download {
      background-color: #218838; /* darker for contrast */
      color: #ffffff;
      padding: 8px 16px;
      border-radius: 4px;
      display: inline-flex;
      align-items: center;
      gap: 5px;
      font-size: 14px;
      border: none;
      cursor: pointer;
    }

    .btn-download:hover {
      background-color: #1e7e34;
    }

    .filter-container {
      display: inline-flex;
      align-items: center;
      margin-left: 10px;
    }

    .filter-label {
      margin-right: 8px;
      font-weight: 600;
      color: #212529;
    }

    .filter-select {
      padding: 8px 12px;
      border: 1px solid #ced4da;
      border-radius: 4px;
      font-size: 14px;
    }

    .table-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .table-header-actions {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .pdf-template {
      position: absolute;
      left: -9999px;
      top: -9999px;
      width: 800px;
      background: #ffffff;
      padding: 20px;
    }
  </style>
</head>

<body>
  <!-- Topbar -->
  <div class="topbar">
    <h1>College of Computing and Information Sciences</h1>

    <div class="topbar-profile">
      {% if instructor_image %}
        <img
          src="{{ url_for('static', filename='uploads/' + instructor_image) }}"
          alt="Instructor profile"
          class="profile-pic"
        >
      {% else %}
        <i class="fas fa-user-circle profile-icon"></i>
      {% endif %}

      <button
        type="button"
        class="logout-btn"
        title="Logout"
        onclick="openLogoutModal(event)"
      >
        <i class="fas fa-sign-out-alt"></i> Logout
      </button>
    </div>
  </div>

  <!-- Sidebar -->
  <div class="sidebar">
    <div class="sidebar-user">
      <img
        src="{{ url_for('static', filename='images/brand.png') }}"
        alt="CCISS logo"
        class="sidebar-logo"
      >
      <p><strong>{{ instructor_name or 'Instructor' }}</strong></p>
    </div>

    <a href="{{ url_for('dashboard.admin_dashboard') }}"><i class="fas fa-tachometer-alt"></i> Dashboard</a>
    <a href="{{ url_for('admin.profile') }}"><i class="fas fa-user"></i> Profile</a>
    <a href="{{ url_for('instructors.list_instructors') }}"><i class="fas fa-chalkboard-teacher"></i> Instructors</a>
    <a href="{{ url_for('courses.list_courses') }}"><i class="fas fa-book"></i> Courses</a>
    <a href="{{ url_for('rooms.list_rooms') }}"><i class="fas fa-door-open"></i> Rooms</a>
    <a href="{{ url_for('subjects.list_subjects') }}"><i class="fas fa-book"></i> CCISS Loader</a>
    <a href="{{ url_for('auto_scheduler.auto_scheduler_home') }}"><i class="fas fa-cogs"></i> Auto-Scheduler</a>
    <a href="{{ url_for('schedules.list_schedules') }}"><i class="fas fa-calendar-alt"></i> Schedules</a>
    <a href="{{ url_for('conflicts.list_conflicts') }}"><i class="fas fa-exclamation-triangle"></i> Conflicts</a>
  </div>

  <!-- Main Content -->
  <div class="main-content">
    <div class="welcome-card">
      <h2>Admin, {{ instructor_name or 'Instructor' }}!</h2>
      <p>Manage and update instructor information here.</p>
    </div>

    <div class="table-header">
      <a href="{{ url_for('instructors.add_instructor') }}" class="btn">Add Instructor</a>

      <div class="table-header-actions">
        <div class="filter-container">
          <label class="filter-label" for="statusFilter">Filter by Status:</label>
          <select class="filter-select" id="statusFilter" onchange="filterInstructors()">
            <option value="all">All</option>
            <option value="Permanent">Permanent</option>
            <option value="Part Time">Part Time</option>
          </select>
        </div>

        <button
          type="button"
          class="btn-download"
          onclick="downloadInstructorsPDF(event)"
        >
          <i class="fas fa-download"></i> Download PDF
        </button>
      </div>
    </div>

    <div class="table-container">
      <table id="instructorsTable">
        <thead>
          <tr>
            <th>Name</th>
            <th>Max Load Units</th>
            <th>Department</th>
            <th>Program</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="instructorsTableBody">
          {% for instructor in instructors %}
            <tr data-status="{{ instructor.status or 'N/A' }}">
              <td>{{ instructor.name }}</td>
              <td>{{ instructor.max_load_units }}</td>
              <td>{{ instructor.department or 'N/A' }}</td>
              <td>{{ instructor.program or 'N/A' }}</td>
              <td>{{ instructor.status or 'N/A' }}</td>
              <td>
                <a href="{{ url_for('instructors.edit_instructor', instructor_id=instructor.instructor_id) }}" class="btn btn-small">Edit</a>
                <button class="btn btn-small btn-danger" onclick="openDeleteModal('{{ instructor.instructor_id }}', '{{ instructor.name }}')">Delete</button>
              </td>
            </tr>
          {% else %}
            <tr>
              <td colspan="6" style="text-align:center;">No instructors found.</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <!-- Delete Modal -->
  <div id="deleteModal" class="modal">
    <div class="modal-content">
      <button type="button" class="close" onclick="closeDeleteModal()" aria-label="Close delete modal">&times;</button>
      <h3>Confirm Delete</h3>
      <p>Are you sure you want to delete <strong id="instructorName"></strong>?</p>
      <form id="deleteForm" method="POST">
        <button type="submit" class="btn btn-danger">Delete</button>
        <button type="button" class="btn btn-secondary" onclick="closeDeleteModal()">Cancel</button>
      </form>
    </div>
  </div>

  <!-- Logout Modal -->
  <div id="logoutModal" class="modal">
    <div class="modal-content">
      <button type="button" class="close" onclick="closeLogoutModal()" aria-label="Close logout modal">&times;</button>
      <h3>Confirm Logout</h3>
      <p>Are you sure you want to logout?</p>
      <form method="GET" action="{{ url_for('logout') }}">
        <button type="submit" class="btn btn-danger">Logout</button>
        <button type="button" class="btn btn-secondary" onclick="closeLogoutModal()">Cancel</button>
      </form>
    </div>
  </div>

<script>
  function openLogoutModal(event) {
    event.preventDefault();
    document.getElementById('logoutModal').style.display = 'block';
  }

  function closeLogoutModal() {
    document.getElementById('logoutModal').style.display = 'none';
  }

  function openDeleteModal(id, name) {
    document.getElementById('instructorName').innerText = name;
    document.getElementById('deleteForm').action = `/admin/instructors/delete/${id}`;
    document.getElementById('deleteModal').style.display = 'block';
  }

  function closeDeleteModal() {
    document.getElementById('deleteModal').style.display = 'none';
  }

  function filterInstructors() {
    const value = document.getElementById('statusFilter').value;
    document.querySelectorAll('#instructorsTableBody tr').forEach(row => {
      row.style.display = value === 'all' || row.dataset.status === value ? '' : 'none';
    });
  }

  globalThis.onclick = function (event) {
    if (event.target === document.getElementById('deleteModal')) closeDeleteModal();
    if (event.target === document.getElementById('logoutModal')) closeLogoutModal();
  };

  function downloadInstructorsPDF(event) {
    event.preventDefault();
    const { jsPDF } = globalThis.jspdf;
    const doc = new jsPDF();
    doc.text('Instructors List', 14, 15);
    doc.save('instructors.pdf');
  }
</script>
</body>
</html>
